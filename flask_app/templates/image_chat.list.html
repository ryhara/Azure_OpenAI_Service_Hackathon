{% extends "layout.html" %}

{% block body %}

<div class="container  flex-column justify-content-center align-items-center">
	<div id="image-box" class="mt-3 w-100">
		<div class="row">
			{% for image in images %}
				<div class="col mb-4">
					<img src="{{ url_for('static', filename='uploads/' + image.file_name) }}" class="response-image mb-2">
					<form id="deleteForm" action="{{ url_for('image_chat.delete', file_name=image.file_name) }}" method="post">
						<button type="submit" class="btn btn-danger btn-sm" onclick="return confirmDelete()">Delete</button>
				</form>
				</div>
			{% endfor %}
		</div>
	</div>
	<div class="chat-form-container fixed-bottom text-center">
		<div class="d-flex mx-auto mb-4 align-items-center" style="width: 60%;">
						<div style="width: 10%;">
							<a href="{{ url_for('image_chat.chat') }}" class="btn btn-secondary mx-2" ><i class="bi bi-arrow-left"></i> Back</a>
						</div>
						<div class="input-group" style="width: 80%;">
							<input type="file" id="image-input" accept="image/*" class="form-control">
							<button class="btn btn-success" type="submit" id="image-upload-button">
								<i class="bi bi-upload"></i> Upload
							</button>
						</div>
		</div>
		<div class="chat-instructions text-center w-50 mx-auto mb-1">
					Click Button to Upload Image
		</div>
	</div>
</div>



<style>
	#image-box {
    max-height: 700px;
    overflow-y: auto;
}
	.chat-instructions {
			color: #999;
			font-size: 12px;
	}
	pre {
			white-space: pre-wrap;
			word-wrap: break-word;
	}
	.image-size {
			width: 1.5em;
			height: 1.5em;
	}
	.response-image {
			width: 300px;
			height: 300px;
	}
</style>

<script>
	function confirmDelete() {
			if (confirm("Are you sure ? This action cannot be undone.")) {
					return true;
			} else {
					return false;
			}
	}
	</script>

<script>
	document.getElementById('image-upload-button').addEventListener('click', function(e) {
		e.preventDefault();
    const imageInput = document.getElementById('image-input');
		if (imageInput.files.length === 0) {
			alert("Please select an image file.");
			return;
		}
		const formData = new FormData();
		formData.append('image-input', imageInput.files[0]);
		fetch('/upload_image', {
			method: 'POST',
			body: formData
		})
		.then(response => response.text())
		.then(data => {
					imageInput.value = '';
					alert("Uploaded Image Successfully!");
					window.location.reload();
			})
			.catch(error => console.error('Error:', error));
	});
	</script>


{% endblock %}